#!/bin/sh

# TODO: Unify in a single script with all the other video-queue-*

queue=~/.cache/youtube-download-queue

[ -e "$queue" ] || exit 1

IFS='|'
while read url resolution format; do
    notify-send "Video downloader" "Downloading $url"
    [ "$resolution" ] && set -- "$@" -r$resolution
    [ "$format" ] && set -- "$@" -f$format

    yd "$@" "$url" && flock "$queue" sed -i 1d "$queue"

    notify-send "Video downloader" "Finished downloading $url"
    unset resolution
    unset format
    set --
done < "$queue"
